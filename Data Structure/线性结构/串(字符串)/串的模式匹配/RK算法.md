# Rabin-Karp

Rabin-Karp算法是一种字符串搜索算法，由Richard M. Karp和Michael O. Rabin于1987年提出，它通过使用哈希函数将字符串匹配问题转换为数字的比较问题，从而在多数情况下能显著提高搜索效率。Rabin-Karp算法特别适合于在一个较大的文本串中查找多个模式串的情况，或者在多个文本串中查找同一个模式串的情况。

## 基本思想

1. 哈希化字符串：算法首先定义一个哈希函数，将模式串和文本串中的子串映射为固定大小的整数（哈希值）。理想情况下，不同的字符串映射到不同的哈希值，但现实中由于哈希空间有限，冲突（不同字符串映射到相同哈希值）在所难免。

2. 滚动哈希：为了高效地在文本串中滑动比较，Rabin-Karp算法使用了“滚动哈希”技巧。这意味着当模式串向右移动一个字符时，不需要重新计算整个子串的哈希值，而是通过简单地调整旧哈希值来反映新增加的字符和移除的字符的影响。这一过程通常涉及加法、减法和模运算。

3. 哈希比较：对于文本串中的每个可能的起始位置，算法计算该位置上长度与模式串相同的子串的哈希值，并与模式串的哈希值比较。如果哈希值相等，则可能存在匹配，此时需要进一步进行精确的字符比较以确认是否真的匹配。

4. 处理冲突：由于哈希冲突的存在，即使哈希值相同也不能断定两字符串相等，因此在哈希值匹配后还需要进行实际的字符串比较验证。如果哈希值不匹配，则直接跳过，避免不必要的字符级比较。

## Rabin-Karp算法的实现原理

1. 哈希函数：哈希函数用于将字符串映射为一个固定长度的整数，以便进行比较操作。在Rabin-Karp算法中，哈希函数通常采用多项式哈希函数，即将字符串视为一个多项式，按照指定的规则将每个字符的ASCII码作为系数，对某个质数取模得到多项式在模质数下的值，也就是哈希值。具体来说，对于长度为n的字符串S和质数p，其哈希值h(S)可以表示为：`h(S) = (S[0] * p^(n-1) + S[1] * p^(n-2) + … + S[n-2] * p + S[n-1]) % q`
其中“^”表示幂运算，“%”表示取模运算，“S[i]”表示字符串S中第i个字符的ASCII码，“q”是一个大于n的质数。

2. 哈希表：哈希表用于记录每个子串的哈希值，并在匹配过程中进行快速查找和比较操作。在Rabin-Karp算法中，可以采用散列表或平衡二叉树等数据结构实现哈希表。为了避免哈希冲突，通常选择较大的质数p和q，并采用链式解决冲突的方法。

例如，假设我们要在主串中查找模式串“abcde”，其中模式串的长度为5，质数p为31，质数q为9973。首先，我们可以计算模式串“abcde”的哈希值为“1997342429”，然后逐个计算主串中每个子串的哈希值，并将其记录在一个哈希表中。具体来说，我们可以计算主串中以第一个字符“a”为起点、长度为5的子串的哈希值为“1240717401”，以第二个字符“b”为起点、长度为5的子串的哈希值为“2016563774”，以第三个字符“a”为起点、长度为5的子串的哈希值为“1240717401”，逐一检查哈希值是否与模式串的哈希值相同，并进一步检查子串和模式串是否完全匹配。

## 关键步骤

1. 初始化：选取一个合适的哈希函数和模数（通常模数较大以减少冲突），计算模式串的哈希值。
2. 滑动窗口：在文本串上使用一个长度等于模式串的滑动窗口，逐步向右移动。
3. 哈希计算：对每个窗口内的子串计算哈希值，并与模式串的哈希值比较。
4. 冲突处理：如果哈希值匹配，则进行实际字符串比较；如果不匹配，直接移动窗口至下一个位置。
5. 匹配确认：一旦找到哈希值匹配且字符串也完全相同的窗口，即找到了一个匹配位置。

## Rabin-Karp算法的优化策略

为了进一步提高Rabin-Karp算法的运行效率，可以采用以下优化策略：

1. 多重哈希（Multiple Hashing）：在哈希函数中使用多个质数进行计算，以减少哈希冲突的发生概率和提高哈希表的容量。
2. 指纹压缩（Fingerprint Compression）：在哈希表中使用除余算法或位运算将哈希值压缩成更小的整数，以节省内存空间和加速比较操作。
3. 字符串预处理（String Preprocessing）：在匹配过程中，通过预处理模式串和主串的前缀和后缀信息，避免无效的比较操作，提高匹配效率。

## 优缺点

优点：

* 高效：在平均情况下，Rabin-Karp算法的时间复杂度接近O(n+m)，其中n是文本串长度，m是模式串长度。
* 灵活：通过调整哈希函数和模数，可以在不同应用场景下达到较好的效果。
* 多模式匹配：可以方便地扩展到在文本中查找多个模式串的情况。

缺点：

* 哈希冲突：尽管概率较小，但哈希冲突可能导致不必要的额外字符串比较。
* 模数选择：模数的选择会影响算法的效率和冲突的概率，需要精心挑选。
* 预处理：虽然不如KMP或Boyer-Moore算法那样需要复杂的预处理，但哈希表的构建也是开销之一。

## 应用场景

Rabin-Karp算法常用于大文本搜索、生物信息学中的DNA序列匹配、大规模数据处理和信息检索系统中。它尤其适合于模式串数量多或文本串非常大的情况。

## 实现

[Rabin-Karp C++](./Rabin-Karp.cpp)
